# Python 数据科学手册

[返回](./index.md)

[toc]

## 第三章 Pandas数据处理

### 3.1 安装并使用Pandas

我们将导入 Pandas 并使用别名 pd：

```python
In[2]: import pandas as pd
```

### 3.2 Pandas对象简介

Pandas 的三个基本数据结构： Series、 DataFrame 和 Index。

#### 3.2.1 Pandas的Series对象

Pandas 的 Series 对象是一个带索引数据构成的一维数组。 

```python
In[2]:  data = pd.Series([0.25, 0.5, 0.75, 1.0])
        data
Out[2]: 0 0.25
        1 0.50
        2 0.75
        3 1.00
dtype: float64
```

我们可以通过 values 属性和 index 属性获取数据， 也可以通过 Python 的中括号索引标签获取。

```python
In[3]: data.values
Out[3]: array([ 0.25, 0.5 , 0.75, 1. ])

In[4]: data.index
Out[4]: RangeIndex(start=0, stop=4, step=1)

In[5]: data[1]
Out[5]: 0.5
In[6]: data[1:3]
Out[6]: 1 0.50
        2 0.75
dtype: float64
```

01. Serise是通用的NumPy数组
    Series 对象和一维 NumPy 数组两者间的本质差异其实是索引： NumPy 数组通过隐式定义的整数索引获取数值， 而 Pandas 的 Series 对象用一种显式定义的索引与数值关联。

    ```python
    In[7]:  data = pd.Series([0.25, 0.5, 0.75, 1.0],
            index=['a', 'b', 'c', 'd'])data
    Out[7]: a 0.25
            b 0.50
            c 0.75
            d 1.00
            dtype: float64
    ```

02. Series是特殊的字典
    可以把 Pandas 的 Series 对象看成一种特殊的 Python 字典，可以直接用 Python 的字典创建一个 Series 对象。

    ```python
    In[11]:  population_dict = {'California': 38332521,
                                'Texas': 26448193,
                                'New York': 19651127,
                                'Florida': 19552860,
                                'Illinois': 12882135}
            population = pd.Series(population_dict)
            population
    Out[11]: California 38332521
             Florida 19552860
             Illinois 12882135
             New York 19651127
             Texas 26448193
             dtype: int64
    ```

03. 创建Series对象

    ```python
        pd.Series(data, index=index)
    ```

    其中， index 是一个可选参数， data 参数支持多种数据类型。

    * data 可以是列表或 NumPy 数组， 这时 index 默认值为整数序列
    * data 也可以是一个标量， 创建 Series 对象时会重复填充到每个索引上
    * data 还可以是一个字典， index 默认是排序的字典键

    每一种形式都可以通过显式指定索引筛选需要的结果：

    ```python
    In[17]: pd.Series({2:'a', 1:'b', 3:'c'}, index=[3, 2])
    Out[17]: 3 c
             2 a
             dtype: object
    ```

#### 3.2.2 Pandas的DataFrame对象

01. DataFrame是通用的NumPy数组
    如果将 Series 类比为带灵活索引的一维数组， 那么 DataFrame就可以看作是一种既有灵活的行索引， 又有灵活列名的二维数组。也可以把 DataFrame 看成是有序排列的若干 Series 对象。

    ```python
    In[19]: states = pd.DataFrame({'population': population,'area': area})
            states
    Out[19]:            area        population
             California 423967      38332521
             Florida    170312      19552860
             Illinois   149995      12882135
             New York   141297      19651127
             Texas      695662      26448193
    ```

02. DataFrame是特殊的字典
    也可以把 DataFrame 看成一种特殊的字典。 字典是一个键映射一个值， 而 DataFrame 是一列映射一个Series 的数据。

    ```python
    In[22]: states['area']
    Out[22]: California 423967
             Florida 170312
             Illinois 149995
             New York 141297
             Texas 695662
             Name: area, dtyp
    ```

03. 创建DataFrame对象：

    (1). 通过单个 Series 对象创建。

    ```python
    In[23]: pd.DataFrame(population, columns=['population'])
    Out[23]: population
             California 38332521
             Florida 19552860
             Illinois 12882135
             New York 19651127
             Texas 26448193
    ```

    (2). 通过字典列表创建。

    ```python
    In[24]: data = [{'a': i, 'b': 2 * i}
                    for i in range(3)]
            pd.DataFrame(data)
    Out[24]:  a b
            0 0 0
            1 1 2
            2 2 4
    ```

    如果字典中有些键不存在， Pandas 会用缺失值 NaN（不是数字，not a number） 来表示

    (3). 通过 Series 对象字典创建。

    ```python
    In[26]: pd.DataFrame({'population': population,'area': area})
    Out[26]: area population
             California 423967 38332521
             Florida 170312 19552860
             Illinois 149995 12882135
             New York 141297 19651127
             Texas 695662 26448193
    ```

    (4). 通过 NumPy 二维数组创建。

    ```python
    In[27]: pd.DataFrame(np.random.rand(3, 2),
            columns=['foo', 'bar'],
            index=['a', 'b', 'c'])
    Out[27]: foo bar
             a 0.865257 0.213169
             b 0.442759 0.108267
             c 0.047110 0.905718
    ```

    (5). 通过 NumPy 结构化数组创建。

    ```python
    In[28]: A = np.zeros(3, dtype=[('A', 'i8'), ('B', 'f8')])
            A
    Out[28]: array([(0, 0.0), (0, 0.0), (0, 0.0)],
                    dtype=[('A', '<i8'), ('B', '<f8')])

    In[29]: pd.DataFrame(A)
    Out[29]:  A B
            0 0 0.0
            1 0 0.0
            2 0 0.0
    ```

#### 3.2.3 Pandas的Index对象

01. 将Index看作不可变数组
    Index 对象的许多操作都像数组。 

    ```python
    In[31]: ind[1]
    Out[31]: 3

    In[32]: ind[::2]
    Out[32]: Int64Index([2, 5, 11], dtype='int64')
    ```

    Index 对象还有许多与 NumPy 数组相似的属性：`ind.size, ind.shape, ind.ndim, ind.dtype`， 不同在于， Index 对象的索引是不可变的，`ind[1] = 0` 这样的操作是不可行的。

02. 将Index看作有序集合

    Pandas 对象被设计用于实现许多操作， 如连接（join） 数据集， 其中会涉及许多集合操作。 Index 对象遵循 Python 标准库的集合（set） 数据结构的许多习惯用法， 包括并集、 交集、 差集等：

    ```python
    In[35]: indA = pd.Index([1, 3, 5, 7, 9])
            indB = pd.Index([2, 3, 5, 7, 11])

    In[36]: indA & indB # 交集
    Out[36]: Int64Index([3, 5, 7], dtype='int64')

    In[37]: indA | indB # 并集
    Out[37]: Int64Index([1, 2, 3, 5, 7, 9, 11], dtype='int64')

    In[38]: indA ^ indB # 异或
    Out[38]: Int64Index([1, 2, 9, 11], dtype='int64')
    ```

